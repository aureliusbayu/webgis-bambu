<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map - Google Sheets</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* This is crucial: if height is 0, the map is invisible */
        body, html { margin: 0; padding: 0; height: 100%; }
        #map { 
            height: 100vh; 
            width: 100%; 
            background: #f0f0f0; /* Light grey so you know the div is there */
        }
        .popup-img { 
            width: 100%; 
            max-width: 200px; 
            height: auto; 
            display: block; 
            margin-top: 8px; 
            border-radius: 4px; 
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script>
        // --- CONFIGURATION ---
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT4z6uYBc3K5jsgJjmVvAMRI0wi442FfRJwQXx9hhVjZpeDj0Fi_khDT8wjbN8Z0J9LhuwQM6vzIagN/pub?output=csv'; 

// Yogyakarta Center Coordinates & Zoom Level
// Zoom 10-11 shows the province, 13 shows the city.
const jogjaCenter = [-7.81, 110.3595]; 
const initialZoom = 11; 
// ---------------------

// 1. Initialize Map IMMEDIATELY at Yogyakarta
// The map will stay here and won't jump when data arrives.
const map = L.map('map').setView(jogjaCenter, initialZoom);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// 2. Fetch Data in the background
Papa.parse(csvUrl, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
        console.log("Data loaded for Yogyakarta area...");
        
        results.data.forEach((row) => {
            const lat = Number(row.lat);
            const lng = Number(row.long);

            if (!isNaN(lat) && !isNaN(lng)) {
                // Construct Popup
                const popupContent = `
                    <div style="min-width: 160px;">
                        <strong>Class:</strong> ${row.class || 'No Class'}<br>
                        <img src="${row.photo}" class="popup-img" alt="Photo" 
                             style="width:100%; margin-top:5px; border-radius:4px;">
                    </div>
                `;

                // Add markers quietly
                L.marker([lat, lng])
                    .bindPopup(popupContent)
                    .addTo(map);
            }
        });

        // IMPORTANT: We do NOT call map.fitBounds() here.
        // This keeps the map exactly where we initialized it.
        console.log("All points placed. View remains at Yogyakarta.");
    }
});
    </script>
</body>

</html>




